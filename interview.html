<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChartMogul | Mohammad Sedigh Ahmadi for Sr Full Stack Engineer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#0ea5e9',
                        'secondary': '#10b981',
                        'accent': '#f59e0b',
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.8s ease-out',
                        'slide-up': 'slideUp 0.6s ease-out',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(40px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        glow: {
                            '0%': { boxShadow: '0 0 20px rgba(14, 165, 233, 0.4)' },
                            '100%': { boxShadow: '0 0 30px rgba(14, 165, 233, 0.8)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0ea5e9 0%, #10b981 100%);
            min-height: 100vh;
        }

        .glass {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .gradient-text {
            background: linear-gradient(135deg, #0ea5e9 0%, #10b981 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .code-block {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 1px solid rgba(148, 163, 184, 0.2);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .section-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .floating-animation {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        .hover-lift {
            transition: all 0.3s ease;
        }

        .hover-lift:hover {
            transform: translateY(-5px);
            box-shadow: 0 35px 60px -12px rgba(0, 0, 0, 0.3);
        }

        @media print {
            body {
                background: white;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .no-print {
                display: none;
            }
            .page-break {
                page-break-before: always;
            }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Background Effects -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute -top-40 -right-40 w-80 h-80 bg-cyan-400 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-pulse"></div>
        <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-emerald-400 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-pulse"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-amber-400 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-pulse"></div>
    </div>

    <div class="relative z-10 max-w-6xl mx-auto px-6 py-12">
        <!-- Main Header -->
        <header class="text-center mb-20 animate-fade-in">
            <div class="bg-white/90 backdrop-filter backdrop-blur-20 rounded-3xl p-12 mb-8 hover-lift shadow-2xl border border-white/30">
                <h1 class="text-6xl font-bold gradient-text mb-4 floating-animation">
                    ChartMogul
                </h1>
                <div class="w-24 h-1 bg-gradient-to-r from-primary to-secondary mx-auto mb-6 rounded-full"></div>
                <p class="text-2xl text-gray-800 font-medium">
                    Mohammad Sedigh Ahmadi
                </p>
                <p class="text-xl text-gray-700 mt-2">
                    Senior Full Stack Engineer Portfolio
                </p>
                <div class="mt-8 flex justify-center space-x-4">
                    <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-gradient-to-r from-primary to-secondary text-white shadow-lg">
                        Full Stack Development
                    </span>
                    <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-gradient-to-r from-secondary to-accent text-white shadow-lg">
                        System Architecture
                    </span>
                </div>
            </div>
        </header>

        <!-- System Design Section -->
        <section class="mb-20 animate-slide-up">
            <div class="section-card rounded-3xl p-10 hover-lift">
                <h2 class="text-4xl font-bold gradient-text mb-8 text-center">
                    System Design
                </h2>
                <p class="text-lg text-gray-700 mb-12 text-center max-w-3xl mx-auto leading-relaxed">
                    Below is the system architecture diagram illustrating the data flow from ingestion to metric generation,
                    followed by the Entity Relationship Model (ERM) diagram for the database schema.
                </p>

                <div class="grid md:grid-cols-2 gap-12">
                    <div class="space-y-6">
                        <h3 class="text-2xl font-semibold text-gray-800 flex items-center">
                            <div class="w-8 h-8 bg-gradient-to-r from-primary to-secondary rounded-full mr-3"></div>
                            System Architecture
                        </h3>
                        <div class="relative group">
                            <div class="absolute inset-0 bg-gradient-to-r from-primary to-secondary rounded-2xl blur opacity-25 group-hover:opacity-50 transition-opacity"></div>
                            <a href="https://ahmadi.dev/design_system_chartmogul" target="_blank" rel="noopener noreferrer" class="block relative">
                                <div class="relative bg-white rounded-2xl p-8 border-2 border-gray-200 hover:border-primary transition-all duration-300 cursor-pointer transform hover:scale-105">
                                    <div class="bg-gradient-to-br from-sky-50 to-cyan-100 rounded-xl p-12 text-center">
                                        <div class="text-4xl mb-4">üèóÔ∏è</div>
                                        <h4 class="text-xl font-semibold text-gray-800 mb-2">Architecture Diagram</h4>
                                        <p class="text-gray-600 mb-4">Data flow visualization</p>
                                        <div class="inline-flex items-center text-sm font-medium text-primary bg-primary/10 px-3 py-1 rounded-full">
                                            üîó Click for interactive view
                                        </div>
                                        <div class="mt-4 text-sm text-gray-500">
                                            ahmadi.dev/design_system_chartmogul
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <h3 class="text-2xl font-semibold text-gray-800 flex items-center">
                            <div class="w-8 h-8 bg-gradient-to-r from-secondary to-accent rounded-full mr-3"></div>
                            Database Schema
                        </h3>
                        <div class="relative group">
                            <div class="absolute inset-0 bg-gradient-to-r from-secondary to-accent rounded-2xl blur opacity-25 group-hover:opacity-50 transition-opacity"></div>
                            <a href="https://ahmadi.dev/erm_chartmogul" target="_blank" rel="noopener noreferrer" class="block relative">
                                <div class="relative bg-white rounded-2xl p-8 border-2 border-gray-200 hover:border-secondary transition-all duration-300 cursor-pointer transform hover:scale-105">
                                    <div class="bg-gradient-to-br from-emerald-50 to-green-100 rounded-xl p-12 text-center">
                                        <div class="text-4xl mb-4">üìä</div>
                                        <h4 class="text-xl font-semibold text-gray-800 mb-2">ERM Diagram</h4>
                                        <p class="text-gray-600 mb-4">Entity relationship model</p>
                                        <div class="inline-flex items-center text-sm font-medium text-secondary bg-secondary/10 px-3 py-1 rounded-full">
                                            üîó Click for interactive view
                                        </div>
                                        <div class="mt-4 text-sm text-gray-500">
                                            ahmadi.dev/erm_chartmogul
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Personal Experiences Section -->
        <section class="mb-20 animate-slide-up">
            <div class="section-card rounded-3xl p-10 hover-lift">
                <h2 class="text-4xl font-bold gradient-text mb-12 text-center">
                    Personal Experiences
                </h2>

                <div class="space-y-12">
                    <!-- Experience 1 -->
                    <div class="relative">
                        <div class="absolute left-0 top-0 w-1 h-full bg-gradient-to-b from-primary to-secondary rounded-full"></div>
                        <div class="ml-8">
                            <h3 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center">
                                <span class="w-12 h-12 bg-gradient-to-r from-primary to-secondary rounded-full flex items-center justify-center text-white font-bold mr-4">1</span>
                                Time Tracking Regulation Launch at Taxmaro
                            </h3>
                            <div class="bg-gradient-to-r from-sky-50 to-cyan-50 rounded-2xl p-8 space-y-4">
                                <p class="text-gray-700 leading-relaxed">
                                    When time tracking regulations were about to become mandatory, we saw an opportunity to gain a major competitive advantage. At Taxmaro, we decided to integrate this as a built-in feature before any public announcement was made. I worked closely with our CEO, discussing the potential market impact and the importance of being first. The challenge was that the regulation details weren't public yet, so we had to work based on assumptions and scattered insights.
                                </p>
                                <p class="text-gray-700 leading-relaxed">
                                    Since we didn't fully understand the regulation domain, designing a robust architecture upfront wasn't realistic. With only four developers on the team, we made a conscious decision to move fast. It required intense collaboration across teams and some serious overwork, but in the end, we were the first HR tool to offer built-in time tracking compliance.
                                </p>
                                <p class="text-gray-700 leading-relaxed">
                                    After the initial success, we came back to the codebase and refactored it for maintainability and long-term support. Looking back, it was a textbook case of choosing product impact over engineering perfection‚Äîand it paid off.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Experience 2 -->
                    <div class="relative">
                        <div class="absolute left-0 top-0 w-1 h-full bg-gradient-to-b from-secondary to-accent rounded-full"></div>
                        <div class="ml-8">
                            <h3 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center">
                                <span class="w-12 h-12 bg-gradient-to-r from-secondary to-accent rounded-full flex items-center justify-center text-white font-bold mr-4">2</span>
                                DATEV Integration at Taxmaro
                            </h3>
                            <div class="bg-gradient-to-r from-emerald-50 to-green-50 rounded-2xl p-8 space-y-4">
                                <p class="text-gray-700 leading-relaxed">
                                    During our integration with DATEV at Taxmaro, we aimed to automate the way accountants processed payroll data. Previously, we provided CSV exports from our HR system, which accountants then manually imported into DATEV‚Äîa process that was slow, error-prone, and frustrating.
                                </p>
                                <p class="text-gray-700 leading-relaxed">
                                    The challenges were intense. The API documentation was unreliable, endpoints were frequently changing, and not all required functionality was available. We manually explored the APIs using Postman to identify correct payloads and hidden requirements. We eventually built our own internal documentation and even created a custom Ruby gem to encapsulate interactions with DATEV cleanly.
                                </p>
                                <p class="text-gray-700 leading-relaxed">
                                    I owned this project end-to-end: communicating with DATEV's developers, writing and testing the integration, defining and splitting tickets, and collaborating with frontend developers. Despite all challenges, we delivered a system that significantly reduced the burden on our users.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Programming Task Section -->
        <section class="mb-20 animate-slide-up">
            <div class="section-card rounded-3xl p-10 hover-lift">
                <h2 class="text-4xl font-bold gradient-text mb-8 text-center">
                    Programming Task
                </h2>
                <p class="text-xl text-gray-700 mb-12 text-center">
                    Fixing an issue with customer metadata
                </p>

                <div class="space-y-12">
                    <!-- Ruby Code Section -->
                    <div>
                        <h3 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center">
                            <div class="w-8 h-8 bg-gradient-to-r from-red-500 to-pink-500 rounded-full mr-3 flex items-center justify-center">
                                <span class="text-white text-sm font-bold">üíé</span>
                            </div>
                            Refactored Ruby Code
                        </h3>
                        <p class="text-gray-700 mb-6 leading-relaxed">
                            The original code was refactored into a dedicated builder class (<code class="bg-gray-100 px-2 py-1 rounded text-sm">CustomerMetadataBuilder</code>)
                            to improve separation of concerns, readability, and testability. This approach encapsulates the logic for building the metadata hash,
                            making the <code class="bg-gray-100 px-2 py-1 rounded text-sm">custom_params</code> method clean and concise.
                        </p>

                        <div class="relative group">
                            <div class="absolute inset-0 bg-gradient-to-r from-gray-900 to-gray-700 rounded-2xl blur opacity-25"></div>
                            <div class="relative">
                                <div class="code-block rounded-2xl overflow-hidden">
                                    <div class="bg-gradient-to-r from-gray-800 to-gray-900 px-6 py-4 border-b border-gray-600">
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                                            <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                            <span class="text-gray-300 text-sm ml-4">customer_metadata_builder.rb</span>
                                        </div>
                                    </div>
                                    <pre class="p-6 text-sm text-gray-100 overflow-x-auto"><code>
                                      class CustomerMetadataBuilder
  # Define metadata keys as constants for easy reference and maintainability
  # This allows us to change the keys in one place if needed, without affecting the rest of the code.
  # And avoids typo errors in string literals throughout the code.

  METADATA_KEYS = {
    account_owner: 'Account owner',
    account_status: 'Account status',
    active_customers: 'Active customers',
    billing_systems: 'Billing system(s)',
    import_status: 'Import status',
    last_active: 'Last active',
    revenue_recognition: 'Revenue recognition access',
    sample_data: 'Sample Data Present?'
  }.freeze

  def initialize(account)
    @account = account
  end

  def call
    # using compact_blank to remove any nil or empty string or empty array values
    # This is important to note that compact_blank is available in Rails 6.1 and later.
    # If you're using an earlier version of Rails, you can use the approach used in the original code

    {
      METADATA_KEYS[:account_owner] => account_owner_info,
      METADATA_KEYS[:account_status] => account_status,
      METADATA_KEYS[:active_customers] => active_customer_count,
      METADATA_KEYS[:billing_systems] => billing_systems,
      METADATA_KEYS[:import_status] => import_status,
      METADATA_KEYS[:last_active] => last_active,
      METADATA_KEYS[:revenue_recognition] => revenue_recognition_enabled?,
      METADATA_KEYS[:sample_data] => sample_data_present?
    }.compact
  end

private

  attr_reader :account

  def account_owner_info
    [owner&.name, owner&.email].compact_blank.join(' ')
  end

  def account_status
    account_details&.account_status
  end

  def active_customer_count
    account_details&.active_customer_count
  end

  def billing_systems
    billing_connectors.presence || ['None configured']
  end

  def import_status
    status = main_connector&.import_status
    status&.humanize || 'Never imported'
  end

  def last_active
    account.last_active_at
  end

  def revenue_recognition_enabled?
    account.rev_rec_enabled?
  end

  def sample_data_present?
    account.sample_data_present?
  end

  def owner
    account&.owner
  end

  def account_details
    account.account_details
  end

  def billing_connectors
    account.billing_connectors
  end

  def main_connector
    account.main_connector
  end
end

def custom_params
  CustomerMetadataBuilder.new(@account).call
end
                                    </code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- RSpec Tests Section -->
                    <div>
                        <h3 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center">
                            <div class="w-8 h-8 bg-gradient-to-r from-green-500 to-teal-500 rounded-full mr-3 flex items-center justify-center">
                                <span class="text-white text-sm font-bold">‚úì</span>
                            </div>
                            RSpec Tests
                        </h3>
                        <p class="text-gray-700 mb-6 leading-relaxed">
                            Comprehensive tests for the <code class="bg-gray-100 px-2 py-1 rounded text-sm">CustomerMetadataBuilder</code> class ensure its correctness
                            and cover various edge cases, such as the presence or absence of data.
                        </p>

                        <div class="relative group">
                            <div class="absolute inset-0 bg-gradient-to-r from-gray-900 to-gray-700 rounded-2xl blur opacity-25"></div>
                            <div class="relative">
                                <div class="code-block rounded-2xl overflow-hidden">
                                    <div class="bg-gradient-to-r from-gray-800 to-gray-900 px-6 py-4 border-b border-gray-600">
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                                            <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                            <span class="text-gray-300 text-sm ml-4">customer_metadata_builder_spec.rb</span>
                                        </div>
                                    </div>
                                    <pre class="p-6 text-sm text-gray-100 overflow-x-auto"><code>
require 'rails_helper'

RSpec.describe CustomerMetadataBuilder do
  let(:account) { double('Account') }
  let(:owner) { double('Owner', name: 'John Doe', email: 'john@example.com') }
  let(:account_details) { double('AccountDetails') }
  let(:billing_connectors) { %w(Stripe PayPal) }
  let(:main_connector) { double('MainConnector') }
  let(:import_status) { double('ImportStatus') }

  let(:builder) { described_class.new(account) }

  before do
    allow(account).to receive(:owner).and_return(owner)
    allow(account).to receive(:account_details).and_return(account_details)
    allow(account).to receive(:billing_connectors).and_return(billing_connectors)
    allow(account).to receive(:main_connector).and_return(main_connector)
    allow(account).to receive(:last_active_at).and_return(Time.current)
    allow(account).to receive(:rev_rec_enabled?).and_return(true)
    allow(account).to receive(:sample_data_present?).and_return(false)

    allow(account_details).to receive(:account_status).and_return('active')
    allow(account_details).to receive(:active_customer_count).and_return(42)

    allow(main_connector).to receive(:import_status).and_return(import_status)
    allow(import_status).to receive(:humanize).and_return('Completed')
  end

  describe '#call' do
    it 'returns a hash with all metadata' do
      result = builder.call

      expect(result).to be_a(Hash)
      expect(result.keys).to contain_exactly(
        'Account owner',
        'Account status',
        'Active customers',
        'Billing system(s)',
        'Import status',
        'Last active',
        'Revenue recognition access',
        'Sample Data Present?'
      )
    end

    it 'excludes nil values from the result' do
      allow(account_details).to receive(:account_status).and_return(nil)
      allow(account_details).to receive(:active_customer_count).and_return(nil)

      result = builder.call

      expect(result).not_to have_key('Account status')
      expect(result).not_to have_key('Active customers')
      # Account owner will still be present because it returns empty string, not nil
      expect(result).to have_key('Account owner')
      expect(result['Account owner']).to eq('John Doe john@example.com')
    end

    it 'includes empty string values in the result' do
      allow(account).to receive(:owner).and_return(nil)

      result = builder.call

      # Account owner returns empty string when owner is nil, so it's still included
      expect(result).to have_key('Account owner')
      expect(result['Account owner']).to eq('')
    end

    it 'includes non-nil values in the result' do
      result = builder.call

      expect(result['Account owner']).to eq('John Doe john@example.com')
      expect(result['Account status']).to eq('active')
      expect(result['Active customers']).to eq(42)
    end
  end

  describe '#account_owner_info' do
    context 'when owner is present' do
      it 'returns formatted owner info' do
        expect(builder.send(:account_owner_info)).to eq('John Doe john@example.com')
      end
    end

    context 'when owner is nil' do
      before { allow(account).to receive(:owner).and_return(nil) }

      it 'returns empty string' do
        expect(builder.send(:account_owner_info)).to eq('')
      end
    end

    context 'when owner has nil name and email' do
      let(:owner) { double('Owner', name: nil, email: nil) }

      it 'returns empty string' do
        expect(builder.send(:account_owner_info)).to eq('')
      end
    end

    context 'when owner has only name' do
      let(:owner) { double('Owner', name: 'John Doe', email: nil) }

      it 'returns only the name' do
        expect(builder.send(:account_owner_info)).to eq('John Doe')
      end
    end

    context 'when owner has only email' do
      let(:owner) { double('Owner', name: nil, email: 'john@example.com') }

      it 'returns only the email' do
        expect(builder.send(:account_owner_info)).to eq('john@example.com')
      end
    end
  end

  describe '#account_status' do
    it 'returns account status from account_details' do
      expect(builder.send(:account_status)).to eq('active')
    end

    context 'when account_details is nil' do
      before { allow(account).to receive(:account_details).and_return(nil) }

      it 'returns nil' do
        expect(builder.send(:account_status)).to be_nil
      end
    end
  end

  describe '#active_customer_count' do
    it 'returns active customer count from account_details' do
      expect(builder.send(:active_customer_count)).to eq(42)
    end

    context 'when account_details is nil' do
      before { allow(account).to receive(:account_details).and_return(nil) }

      it 'returns nil' do
        expect(builder.send(:active_customer_count)).to be_nil
      end
    end
  end

  describe '#billing_systems' do
    context 'when billing_connectors are present' do
      it 'returns the billing connectors' do
        expect(builder.send(:billing_systems)).to eq(%w(Stripe PayPal))
      end
    end

    context 'when billing_connectors are empty' do
      before { allow(account).to receive(:billing_connectors).and_return([]) }

      it 'returns default message' do
        expect(builder.send(:billing_systems)).to eq(['None configured'])
      end
    end

    context 'when billing_connectors are nil' do
      before { allow(account).to receive(:billing_connectors).and_return(nil) }

      it 'returns default message' do
        expect(builder.send(:billing_systems)).to eq(['None configured'])
      end
    end
  end

  describe '#import_status' do
    context 'when main_connector and import_status are present' do
      it 'returns humanized import status' do
        expect(builder.send(:import_status)).to eq('Completed')
      end
    end

    context 'when main_connector is nil' do
      before { allow(account).to receive(:main_connector).and_return(nil) }

      it 'returns default message' do
        expect(builder.send(:import_status)).to eq('Never imported')
      end
    end

    context 'when import_status is nil' do
      before { allow(main_connector).to receive(:import_status).and_return(nil) }

      it 'returns default message' do
        expect(builder.send(:import_status)).to eq('Never imported')
      end
    end

    context 'when humanize returns nil' do
      before { allow(import_status).to receive(:humanize).and_return(nil) }

      it 'returns default message' do
        expect(builder.send(:import_status)).to eq('Never imported')
      end
    end
  end

  describe '#last_active' do
    let(:last_active_time) { 2.days.ago }

    before { allow(account).to receive(:last_active_at).and_return(last_active_time) }

    it 'returns the last active time' do
      expect(builder.send(:last_active)).to eq(last_active_time)
    end

    context 'when last_active_at is nil' do
      before { allow(account).to receive(:last_active_at).and_return(nil) }

      it 'returns nil' do
        expect(builder.send(:last_active)).to be_nil
      end
    end
  end

  describe '#revenue_recognition_enabled?' do
    context 'when revenue recognition is enabled' do
      before { allow(account).to receive(:rev_rec_enabled?).and_return(true) }

      it 'returns true' do
        expect(builder.send(:revenue_recognition_enabled?)).to be true
      end
    end

    context 'when revenue recognition is disabled' do
      before { allow(account).to receive(:rev_rec_enabled?).and_return(false) }

      it 'returns false' do
        expect(builder.send(:revenue_recognition_enabled?)).to be false
      end
    end
  end

  describe '#sample_data_present?' do
    context 'when sample data is present' do
      before { allow(account).to receive(:sample_data_present?).and_return(true) }

      it 'returns true' do
        expect(builder.send(:sample_data_present?)).to be true
      end
    end

    context 'when sample data is not present' do
      before { allow(account).to receive(:sample_data_present?).and_return(false) }

      it 'returns false' do
        expect(builder.send(:sample_data_present?)).to be false
      end
    end
  end

  describe 'constants' do
    it 'has all expected metadata keys' do
      expect(CustomerMetadataBuilder::METADATA_KEYS).to eq({
                                                             account_owner: 'Account owner',
                                                             account_status: 'Account status',
                                                             active_customers: 'Active customers',
                                                             billing_systems: 'Billing system(s)',
                                                             import_status: 'Import status',
                                                             last_active: 'Last active',
                                                             revenue_recognition: 'Revenue recognition access',
                                                             sample_data: 'Sample Data Present?'
                                                           })
    end

    it 'has frozen constant' do
      expect(CustomerMetadataBuilder::METADATA_KEYS).to be_frozen
    end
  end

  # Integration test to make sure everything works together
  describe 'integration' do
    context 'with a fully populated account' do
      it 'returns complete metadata' do
        result = builder.call

        expect(result).to eq({
                               'Account owner' => 'John Doe john@example.com',
                               'Account status' => 'active',
                               'Active customers' => 42,
                               'Billing system(s)' => %w(Stripe PayPal),
                               'Import status' => 'Completed',
                               'Last active' => account.last_active_at,
                               'Revenue recognition access' => true,
                               'Sample Data Present?' => false
                             })
      end
    end

    context 'with minimal account data' do
      before do
        allow(account).to receive(:owner).and_return(nil)
        allow(account).to receive(:account_details).and_return(nil)
        allow(account).to receive(:billing_connectors).and_return(nil)
        allow(account).to receive(:main_connector).and_return(nil)
        allow(account).to receive(:last_active_at).and_return(nil)
        allow(account).to receive(:rev_rec_enabled?).and_return(false)
        allow(account).to receive(:sample_data_present?).and_return(false)
      end

      it 'returns only non-nil values' do
        result = builder.call

        expect(result).to eq({
                               'Account owner' => '',
                               'Billing system(s)' => ['None configured'],
                               'Import status' => 'Never imported',
                               'Revenue recognition access' => false,
                               'Sample Data Present?' => false
                             })
      end
    end
  end
end

                                    </code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="text-center py-12 animate-fade-in">
            <div class="glass rounded-3xl p-8">
                <p class="text-gray-600 text-lg">
                    Ready to bring innovative solutions to ChartMogul
                </p>
                <div class="mt-4 flex justify-center space-x-6">
                    <div class="w-12 h-12 bg-gradient-to-r from-primary to-secondary rounded-full flex items-center justify-center animate-glow">
                        <span class="text-white font-bold">MA</span>
                    </div>
                </div>
            </div>
        </footer>
    </div>
</body>
</html>